---
# Docker setup and validation tasks

- name: Read Docker images list
  ansible.builtin.slurp:
    src: "{{ config_dir_abs_path }}/docker/images.txt"
  register: docker_images_file

- name: Set images list
  ansible.builtin.set_fact:
    docker_images: "{{ docker_images_file.content | b64decode | split('\n') | select | list }}"

- name: Pull Docker images
  ansible.builtin.command: docker pull {{ item }}
  register: docker_pull_result
  changed_when: false
  loop: "{{ docker_images }}"

- name: Display pull results
  ansible.builtin.debug:
    msg: "Pulling {{ item.item }}... {{ '✅ pulled' if item.rc == 0 else '❌ failed' }}"
  loop: "{{ docker_pull_result.results | default([]) }}"

- name: Confirm Docker images are available
  ansible.builtin.command: docker images --format {% raw %}'table {{.Repository}}:{{.Tag}}'{% endraw %}
  register: docker_images_list_result
  changed_when: false

- name: Display available Docker images
  ansible.builtin.debug:
    msg: "{{ docker_images_list_result.stdout }}"
