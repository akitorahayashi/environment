---
- name: "Install cask packages from Brewfile (profile-specific or common fallback)"
  ansible.builtin.command:
    cmd: "brew bundle --file={{ brewfile_path }}"
  register: brew_bundle_result
  changed_when: "'Installing' in brew_bundle_result.stdout"
  vars:
    brewfile_path: "{{ lookup('first_found', brewfile_candidates) }}"
    brewfile_candidates:
      - "{{ role_path }}/config/profiles/{{ profile }}/cask/Brewfile"
      - "{{ role_path }}/config/common/cask/Brewfile"
