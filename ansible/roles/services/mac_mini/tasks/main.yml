---
- name: "Deploy all services for mac-mini"
  community.docker.docker_compose_v2:
    project_src: "{{ repo_root_path }}/ansible/services/mac-mini/compose/"
    files: ["llm-services.yml"]
    state: present
    recreate: auto

- name: "Wait for LLM service ports to become available"
  ansible.builtin.wait_for:
    host: 127.0.0.1
    port: "{{ item.port }}"
    timeout: 60
  loop:
    - { name: "ollama", port: "{{ services_mac_mini_ollama_service_port | default(11435) }}" }
    - { name: "mlx", port: "{{ services_mac_mini_mlx_service_port | default(8081) }}" }
  loop_control:
    label: "{{ item.name }}"
