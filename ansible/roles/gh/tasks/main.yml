---
- name: "Install GitHub CLI"
  community.general.homebrew:
    name: gh
    state: present

- name: "Ensure .config/gh directory exists"
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/gh"
    state: directory
    mode: "0755"

- name: "Symlink gh config.yml"
  ansible.builtin.file:
    src: "{{ role_path }}/config/common/config.yml"
    dest: "{{ ansible_env.HOME }}/.config/gh/config.yml"
    state: link
    force: true

- name: "Ensure ~/.scripts/python directory exists"
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.scripts/python"
    state: directory
    mode: "0755"

- name: "Find GitHub helper scripts"
  ansible.builtin.find:
    paths: "{{ role_path }}/scripts"
    patterns: "*.py"
    file_type: file
  register: gh_helper_scripts

- name: "Symlink GitHub helper scripts to ~/.scripts/python"
  ansible.builtin.file:
    src: "{{ item.path }}"
    dest: "{{ ansible_env.HOME }}/.scripts/python/{{ item.path | basename }}"
    state: link
    force: true
    mode: "0755"
  loop: "{{ gh_helper_scripts.files }}"
  loop_control:
    label: "{{ item.path | basename }}"
